pipeline any{
    agent any{
        tools{
            maven 'Maven_3.9'
            jdk 'JDK_17'
        }
        environment{
            IMAGE_NAME="vinod-demo-app"
            IMAGE_TAG="latest"
            username="vinnu1487"
            repo="demo1"
            password="Vinod1487@"
        }
        stages{
            stage('Checkout'){
                steps{
                    git branch: 'main', url: 'https://github.com/vinodkumarthati/demo1.git'
                    echo 'Code Checkout Completed'
        }
            }
            stage('Build'){
                steps{
                    echo 'Building the Application'
                    sh "'${MVN_HOME}/bin/mvn' clean package"
                }
            }
            stage('test'){
                steps{
                    echo 'Running Unit Tests'
                    sh "'${MVN_HOME}/bin/mvn' test"
                }
            }
            stage('Run Application'){
                steps{
                    echo 'Running the Java Application'
                    sh "java -cp target/demo-1.0.0.jar com.example.App"
                }
            }
            stage('Archive Artifacts'){
                steps{
                    echo 'Archiving the Artifacts'
                    archiveArtifacts artifacts: 'target/*.jar', fingerprint: true

                }}
                stage('Docker Build'){
                steps{
                    echo 'Building Docker Image'
                    sh "docker build -t ${IMAGE_NAME}:${IMAGE_TAG} ."
                }
                }
                stage('Run the Container'){
                    steps{
                        echo 'running docker'
                        sh "docker run -d -p 8000:8000 --name demo-app ${IMAGE_NAME}:${IMAGE_TAG} || true"
                    }
                }
                stage('docker push'){
                    steps{
                        echo 'pushing the image to docker hub'
                        script{
                            sh """
                                echo ${password} | docker login -u ${username} -p ${pasword}
                                docker tag ${IMAGE_NAME}:${IMAGE_TAG} ${username}/${repo}:${IMAGE_TAG}
                                docker push ${username}/${repo}:${IMAGE_TAG}"""
                        }
                    }
                }
                post{always}{
                    stage('succes'){
                        steps{
                            echo 'success'
                        }
                    }
                    }
                
                        
                    }
    }
}
                
            

